---
applyTo: "watch-duty-manager/**/*"
---

# ディレクトリ構成と使用技術

## ディレクトリ構成

- `app/` ... アプリケーション本体（React/Remixベースのフロントエンド、コンポーネント、ドメインロジック、ルーティング等）
  - `components/` ... UIコンポーネント群
  - `domain/` ... ドメイン層（ビジネスロジック）
  - `routes/` ... Remixのルーティング
  - `styles/` ... CSSやTailwind等のスタイル
  - `utils/` ... ユーティリティ関数
- `prisma/` ... Prisma ORMのスキーマやマイグレーション
- `container/` ... コンテナ関連（Docker Compose, 設定ファイル等）
- `infra/` ... インフラ構成（CDK, IaC）
- `public/` ... 静的ファイル
- `build/` ... ビルド成果物
- `logs/` ... ログファイル
- `example/` ... サンプルデータ
- `scripts/` ... スクリプト

## 使用技術

- フロントエンド: React, Remix, TypeScript, Tailwind CSS
- バックエンド: Node.js, Prisma ORM, MySQL
- インフラ: Docker, AWS CDK
- テスト: Jest
- その他: ESLint, Prettier, Vite, Firebase（認証）

# アプリケーションの主要な概念

このアプリケーションは、アニメ作品の視聴管理を目的としたシステムです。以下のような主要なドメイン概念を持ちます。

## 概念一覧

### 1. アニメ作品（Work）
- アニメのタイトルや公開日、話数、公式サイト、Twitter情報などを管理します。
- 1つの作品は複数のエピソード（話）を持ちます。

### 2. エピソード（Episode）
- 各アニメ作品に紐づく単話情報です。
- 各話のタイトル、公開日、説明などを管理します。
- 作品IDと話数（count）の複合主キーで一意に識別されます。

### 3. ユーザー（User）
- Firebase認証を利用して管理されるアカウントです。
- Prismaスキーマ上はuserId（文字列）で識別されます。

### 4. 視聴登録（SubscribedWorksOnUser）
- ユーザーがどの作品を視聴登録しているかを管理します。
- 視聴開始の遅延や、視聴用URLなども保持できます。

### 5. 視聴済みエピソード（WatchedEpisodesOnUser）
- ユーザーがどのエピソードを視聴済みかを記録します。
- 視聴日時、コメント、評価（rating）なども記録できます。

## 関連
- 1つの作品（Work）は複数のエピソード（Episode）を持つ
- 1人のユーザーは複数の作品を視聴登録できる
- 1人のユーザーは複数のエピソードを視聴済みとして記録できる

## その他
- データベースはPrisma ORM + MySQLで管理
- 認証はFirebaseを利用
- 作品・エピソード・ユーザー間の関係はPrismaスキーマで厳密に定義

# 開発手順

- タスクの終了時には、自らの判断がユーザーによって訂正された箇所を振り返り、修正点を.github/copilot-instructions.mdに追記せよ
- 開発上必要な操作はpackage.jsonにまとめてあります。ターミナルの操作が必要なときはまずこれらを参照してください
  - 型チェック `npm run test:tsc`
  - テスト `npm run test`
  - デバッグ起動は `npm run dev`

- 変更を加えた後は型チェックとテストを行ってください
- 変更を行う前に、必ずテストの存在を確認し、テストが既存のコードで動作することを確認すること
- eslintのコメントが付いている箇所はlintが落ちても修正しない
- 不要なimport文は削除する
